<ion-content>
  <app-site-header></app-site-header>

  <ng-container *ngIf="!roomNotFound; else roomNotFoundMessage">

  <ion-grid class="ion-padding" style="padding:40px">
    <ion-row>
      <ion-col size-lg="8" size-md="12" size-sm="12" class="ion-padding-horizontal"
        style="margin-bottom: 50px; margin-top: 100px;">
        <ng-container *ngTemplateOutlet="carousel"></ng-container>
        <div class="detail">
          <div class="room-title">{{data?.Title}}</div>
          <div class="room-type">{{data?.RoomType}}</div>
          <div class="rent">Space Type:
            <div class="space-type">{{data?.Rent}}</div>
          </div>


          <div class="details">Details:
            <div class="deets">{{data?.Details}}</div>
          </div>

          <div style="margin-bottom: 15px;">
            <div class="rent">
              <span *ngIf="data?.Gender === 'Male'" style="color: blue;"><ion-icon name="man"
                  style="color: blue;"></ion-icon>MALE TENANT ONLY</span>
              <span *ngIf="data?.Gender === 'Female'" style="color: fuchsia;"><ion-icon name="woman"
                  style="color: fuchsia; font-size: 20px;"></ion-icon>FEMALE
                TENANT ONLY
              </span>
              <span *ngIf="data?.Gender === 'Both'">
                <ion-icon name="man" style="color: blue; font-size: 20px;"></ion-icon>
                <ion-icon name="woman" style="color: fuchsia; font-size: 20px;"></ion-icon>BOTH MALE AND
                FEMALE
              </span>
            </div>
          </div>

          <div class=" amenities">
            <div id="amenities-header">Amenities: </div>
            <ion-grid>
              <ion-row>
                <ion-col size-lg="3" size-sm="2" id="amenities" *ngFor="let ame of data?.Amenities">
                  <span *ngIf="ame === 'WiFi'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19 " fill="#000" class="bi bi-wifi"
                      viewBox="0 0 16 16">
                      <path
                        d="M15.384 6.115a.485.485 0 0 0-.047-.736A12.444 12.444 0 0 0 8 3C5.259 3 2.723 3.882.663 5.379a.485.485 0 0 0-.048.736.518.518 0 0 0 .668.05A11.448 11.448 0 0 1 8 4c2.507 0 4.827.802 6.716 2.164.205.148.49.13.668-.049z" />
                      <path
                        d="M13.229 8.271a.482.482 0 0 0-.063-.745A9.455 9.455 0 0 0 8 6c-1.905 0-3.68.56-5.166 1.526a.48.48 0 0 0-.063.745.525.525 0 0 0 .652.065A8.46 8.46 0 0 1 8 7a8.46 8.46 0 0 1 4.576 1.336c.206.132.48.108.653-.065zm-2.183 2.183c.226-.226.185-.605-.1-.75A6.473 6.473 0 0 0 8 9c-1.06 0-2.062.254-2.946.704-.285.145-.326.524-.1.75l.015.015c.16.16.407.19.611.09A5.478 5.478 0 0 1 8 10c.868 0 1.69.201 2.42.56.203.1.45.07.61-.091l.016-.015zM9.06 12.44c.196-.196.198-.52-.04-.66A1.99 1.99 0 0 0 8 11.5a1.99 1.99 0 0 0-1.02.28c-.238.14-.236.464-.04.66l.706.706a.5.5 0 0 0 .707 0l.707-.707z" />
                    </svg>
                  </span>

                  <span *ngIf="ame === 'TV'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="#000" class="bi bi-tv"
                      viewBox="0 0 16 16">
                      <path
                        d="M2.5 13.5A.5.5 0 0 1 3 13h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zM13.991 3l.024.001a1.46 1.46 0 0 1 .538.143.757.757 0 0 1 .302.254c.067.1.145.277.145.602v5.991l-.001.024a1.464 1.464 0 0 1-.143.538.758.758 0 0 1-.254.302c-.1.067-.277.145-.602.145H2.009l-.024-.001a1.464 1.464 0 0 1-.538-.143.758.758 0 0 1-.302-.254C1.078 10.502 1 10.325 1 10V4.009l.001-.024a1.46 1.46 0 0 1 .143-.538.758.758 0 0 1 .254-.302C1.498 3.078 1.675 3 2 3h11.991zM14 2H2C0 2 0 4 0 4v6c0 2 2 2 2 2h12c2 0 2-2 2-2V4c0-2-2-2-2-2z" />
                    </svg>
                  </span>

                  <span *ngIf="ame === 'Kitchen'" class="fa fa-cutlery" style="font-size: 18;" fill="#000"></span>

                  <span *ngIf="ame === 'Parking Lot'" class="fa fa-car" style="font-size: 18;" fill="#000"></span>

                  <span *ngIf="ame === 'Air Conditioner'" class="fa fa-snowflake-o" style="font-size: 18;"
                    fill="#000"></span>

                  <span *ngIf="ame === 'Work Space'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="#000"
                      class="bi bi-person-workspace" viewBox="0 0 16 16">
                      <path d="M4 16s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H4Zm4-5.95a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z" />
                      <path
                        d="M2 1a2 2 0 0 0-2 2v9.5A1.5 1.5 0 0 0 1.5 14h.653a5.373 5.373 0 0 1 1.066-2H1V3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v9h-2.219c.554.654.89 1.373 1.066 2h.653a1.5 1.5 0 0 0 1.5-1.5V3a2 2 0 0 0-2-2H2Z" />
                    </svg>
                  </span>

                  <span *ngIf="ame === 'Washer'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="#000"
                      class="bi bi-droplet-fill" viewBox="0 0 16 16">
                      <path
                        d="M8 16a6 6 0 0 0 6-6c0-1.655-1.122-2.904-2.432-4.362C10.254 4.176 8.75 2.503 8 0c0 0-6 5.686-6 10a6 6 0 0 0 6 6ZM6.646 4.646l.708.708c-.29.29-1.128 1.311-1.907 2.87l-.894-.448c.82-1.641 1.717-2.753 2.093-3.13Z" />
                    </svg>
                  </span>
                  {{ame}}
                </ion-col>
              </ion-row>
            </ion-grid>
          </div>

          <div class="contact">
            <div class="host">Hosted by:</div>
            <span class="host-img">
              <img [src]="owner?.profpic" style="width: 50px">
            </span>
            <span class="contact-owner">{{owner?.FName}} {{owner?.LName}}</span>
          </div>
          <span *ngIf="filterTenant()===true">
            <ion-button (click)="contactOwner()" style="font-family: Montserrat; margin-left: 20px; ">Contact
              Owner</ion-button>
          </span>
        </div>
      </ion-col>

      <ion-col size-lg="4" size-md="12" size-sm="12" class="ion-no-padding">
        <div class="map_container">
          <div id="map"></div>
        </div>

        <ng-container *ngTemplateOutlet="reservation"></ng-container>

      </ion-col>
    </ion-row>
  </ion-grid>

  <div class="p-4 p-md-5 text-center text-lg-start shadow-1-strong rounded">
    <div *ngFor="let data of review" class="row d-flex">
      <div class="col-md-6">
        <div class="card review-card">
          <div class="card-body m-3">
            <div class="row align-items-center">
              <div class="col-lg-4 mb-4">
                <div class="profile-pic-container">
                  <div class="profile-pic-wrapper">
                    <img [src]="data?.profpic" class="rounded-circle img-fluid shadow-1 profile-pic"
                      alt="Profile Picture" />
                  </div>
                </div>
              </div>
              <div class="col-lg-8">
                <div class="rating-container">
                  <ion-icon class="rating-star" *ngFor="let i of [1,2,3,4,5]"
                    [name]="i <= data.Rating ? 'star' : 'star-outline'"></ion-icon>
                </div>
                <p class="text-muted fw-light mb-4 review-text">
                  {{ data?.Review }}
                </p>
                <p class="lead mb-2 reviewer-name">{{ data?.Name }}</p>
                <p class="text-muted mb-0 role">Tenant</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="rating-review" *ngIf="filterTenant()===true">
    <div class="review-title">
      <h2>Leave a Review</h2>
    </div>
    <form [formGroup]="reviewForm">

      <div class="rating-container">
        <ion-icon class="rating-star" *ngFor="let i of [1, 2, 3, 4, 5]" [name]="i <= star ? 'star' : 'star-outline'"
          (click)="Rate(i)"></ion-icon>
      </div>

      <div class="form-group">
        <textarea class="form-control" id="review" rows="3" formControlName="Review"></textarea>
      </div>

      <button class="reviewBTN btn btn-primary" (click)="addReview()">Submit</button>

    </form>
  </div>

  </ng-container>

  <footer>
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <img src="assets/footer logo.png" alt="Logo">
          <p style="font-family: Montserrat; font-size: 16px;">A boarding house search & reservation in Science City of
            Muñoz.</p>
          <ul class="social-icons">
            <a href="#"><ion-icon name="logo-facebook"></ion-icon></a>
            <a href="#"><ion-icon name="logo-instagram"></ion-icon></a>
            <a href="#"><ion-icon name="logo-linkedin"></ion-icon></a>
            <a href="#"><ion-icon name="mail"></ion-icon></a>
            <a href="#"><ion-icon name="logo-dribbble"></ion-icon></a>
          </ul>
        </div>
        <div class="col-md-3">
          <h6 style="font-family: Montserrat; font-size: 16px;">ABOUT SPOT-A-HOME</h6>
          <ul class="footer-links">
            <li><a href="#" style="font-family: Montserrat; font-size: 16px;">About Us</a></li>
            <li><a href="#" style="font-family: Montserrat; font-size: 16px;">Contact Us</a></li>
          </ul>
        </div>
        <div class="col-md-3">
          <h6 style="font-family: Montserrat; font-size: 16px;">TERMS & POLICY</h6>
          <ul class="footer-links">
            <li><a href="#" style="font-family: Montserrat; font-size: 16px;">Terms & Condition</a></li>
            <li><a href="#" style="font-family: Montserrat; font-size: 16px;">Privacy Policy</a></li>

          </ul>
        </div>
        <div class="col-md-3">
          <h6 style="font-family: Montserrat; font-size: 16px;">NEWSLETTER</h6>
          <p style="font-family: Montserrat; font-size: 16px;">Here's our mode of payments.</p>
          <img src="assets/p1.png">
          <img src="assets/p2.png">
          <img src="assets/p3.png">
          <img src="assets/p4.png">
          <img src="assets/p5.png">
        </div>
      </div>
    </div>
  </footer>

  <footer class="bottom-footer">
    <div class="bottom-footer-center" style="font-family: Montserrat; font-size: 16px;">
      Copyright <span>&copy;</span> 2023 SPOT-A-HOME By CJL
    </div>
  </footer>
</ion-content>

<ng-template #roomNotFoundMessage>
  <ion-row>
    <ion-col class="ion-text-center ion-padding ion-margin">
      <!--TODO put image or something here-->
      <div style="height: 500px; margin-top: 100px;">placeholder</div>
      Room not found!
    </ion-col>
  </ion-row>
</ng-template>

<ng-template #reservation>
  <ion-card class="price-card" *ngIf="data">
    <ion-card-header>
      <ion-card-title class="ion-text-center payment-title" style="font-family: Montserrat;">
        {{ data?.RoomType === 'Shared Room' ? 'Reserve a BEDSPACE' : 'Reserve a ROOM'}}
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-row>
        <ion-col>
          <h1 class="ion-text-center price-text" style="font-size: 25px;">₱{{data?.priceSub}}/month</h1>
        </ion-col>
      </ion-row>

      <ng-container *ngIf="data?.RoomType === 'Shared Room'">
        <ion-row>
          <ion-col>
            <h2 class="ion-text-center" style="font-family: Montserrat;"><ion-icon color="#000"
                name="bed-outline"></ion-icon> CHOOSE BED
              PLACEMENT:</h2>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col class="ion-no-padding">
            <h2 style="font-family: Montserrat;">
              TOP BUNK:
            </h2>
          </ion-col>
        </ion-row>
        <ion-row>
          <ng-container *ngFor="let seat of data?.Bed" [class.occupied]="seat.selected || seat.occupied">
            <ion-col *ngIf="seat.status === 'up'" style="font-family: Montserrat;">
              <ng-container *ngTemplateOutlet="bedButton; context: {seat: seat}"></ng-container>
            </ion-col>
          </ng-container>
        </ion-row>
        <ion-col class="ion-no-padding">
          <h2 style="font-family: Montserrat;">
            BOTTOM BUNK:
          </h2>
        </ion-col>
        <ion-row>
          <ng-container *ngFor="let seat of data?.Bed" [class.occupied]="seat.selected || seat.occupied">
            <ion-col *ngIf="seat.status === 'down'" style="font-family: Montserrat; max-width: 100px;">
              <ng-container *ngTemplateOutlet="bedButton; context: {seat: seat}"></ng-container>
            </ion-col>
          </ng-container>
        </ion-row>
      </ng-container>

      <ng-template #bedButton let-seat="seat">
        <ion-button class="bed_btn"
          [color]="seat.occupied && seat.occupied.email === email && seat.occupied.status === 'paidPayment' ? 'success' : 'primary' "
          size="small" shape="round" expand="full"
          [disabled]="(isReserving | async) || seat.occupied || this.pendingPayment" (click)="toggleSeat(seat)">
          <ion-icon
            [name]="seat.occupied && seat.occupied.status === 'paidPayment' ? 'lock-closed-outline' :seat.occupied && seat.occupied.status === 'pendingPayment' ? 'hourglass-outline' : seat.selected ? 'checkmark-circle' : 'checkmark-circle-outline'"></ion-icon>
          {{ 'Bed' + seat?.id }}
        </ion-button>
      </ng-template>

      <ion-row>
        <ion-col class="payment-col">
          <span *ngIf="tenant?.Gender === data?.Gender || data.Gender === 'Both' && tenant">
            <ion-button size="small" shape="round" strong="true" class="reserve-button" (click)="reserveBedspace()"
              [disabled]="(this.isReserving | async) || this.pendingPayment || this.data?.occupied"
              style="font-family: Montserrat;">
              <ion-spinner *ngIf="this.isReserving | async"></ion-spinner>
              {{ (this.isReserving | async) || this.pendingPayment || this.data?.occupied ? 'Reserved' : 'Reserve' }}
            </ion-button>
          </span>
        </ion-col>
      </ion-row>

      <div *ngIf="pendingPayment" class="ion-padding-horizontal">
        <span style="font-family: Montserrat;">Please click on <a [href]="pendingPayment.occupied.checkoutUrl">this
            link</a> to pay for your
          pending reservation.</span>
      </div>

      <ion-row>
        <ion-col class="ion-no-padding">
          <h2 style="font-family: Montserrat;">
            Payment methods:
          </h2>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col class="payment-options">
          <img src="/assets/payments/card.png" alt="Cards">
          <img src="/assets/payments/gcash.png" alt="Gcash">
          <img src="/assets/payments/maya.png" alt="Maya">
          <img src="/assets/payments/grabpay.svg" alt="Grab pay">
        </ion-col>
      </ion-row>
      <div class="ion-padding">
        <span class="note" style="font-family: Montserrat;">Note: If payment for the reservation is not made within
          24hrs, the reservation will be
          automatically cancelled.</span>
      </div>
    </ion-card-content>
  </ion-card>
</ng-template>

<ng-template #carousel>
  <gallery [items]="galleryItems$ | async" gallerize imageSize="cover"></gallery>
</ng-template>
